name: Dev Deployment-test

on:
  push:
    branches:
    - development-test
jobs:
  sanit_build:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2.0.0
      - name: Install Packages 
        run: |
         sudo apt update && sudo apt install groovy 
      #   sudo groovy ./devops/setenv.groovy 
      #   sudo chmod +x ${GITHUB_WORKSPACE} -R
       
     # - name: Set Sanity Procject information 
     #   env:
     #     PROJECT_NAME: "dev-demo"
     #     PROJECT_ID: "bre6fb2q"
     #     DATEAET_NAME: "devdataset"
     #   run: |
     #     sudo sed -i "s|projectname|$PROJECT_NAME|g;s|projectid|$PROJECT_ID|g;s|datasetname|$DATEAET_NAME|g" sanity.json 
          
     # - name: Sanity Check 
     #   run: sudo sanity check
        
     # - name: Sonar Analyis 
     #   run: |
     #     BRANCH=`echo ${GITHUB_REF} | awk -F "/" '{print $NF}'`
     #     echo "sonar.projectName=Nexxus-Linnox-${BRANCH}" >> devops/sonar-project.properties 
     #     echo "sonar.login=${{ secrets.SONAR_AUTH_TOKEN}}" >> devops/sonar-project.properties
     #     echo "sonar.host.url=${{ secrets.SONAR_HOST_URL }}" >> devops/sonar-project.properties
     #     sudo ./sonar/bin/sonar-scanner -Dproject.settings=./devops/sonar-project.properties      
           
      #- name: Sanity Build 
      #  run: | 
      #    sudo sanity build
          
      - name: Deploy to Sanity
        run: | 
          sudo groovy ./devops/sanity.groovy 
          ls -l /home/runner/.config/
 
                 
     #    sudo mkdir -p /home/runner/.config/sanity/ 
     #    sudo cp -p config.json /home/runner/.config/sanity/
     #    sudo sed -i "s|SANITY_AUTH_TOKEN|`echo ${{ secrets.SANITY_AUTH_TOKEN }}`|g" /home/runner/.config/sanity/config.json
     #    echo `cat sanity.json  | jq -r .project.name` | sudo sanity deploy
     
     # - name: Deploy to Netlify
     #   env:
     #     SITE_ID: "b0a2b151-10a4-4e8f-83fc-d6ef9ce1fffb"
     #   run: |
     #    export  NETLIFY_AUTH_TOKEN=${{ secrets.NETLIFY_AUTH_TOKEN }}
     #    sudo netlify deploy -p --auth $NETLIFY_AUTH_TOKEN  -s ${SITE_ID}
