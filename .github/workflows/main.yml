name: Sanity_CICD

on:
  push:
    branches:
    - master
jobs:
  sanit_build:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2.0.0
      - name: Install Packages 
        run: |
         sudo apt update && sudo apt install nodejs openjdk-8-jre unzip
     #    sudo npm install -g @sanity/cli  
       
      #- name: Sanity check 
      #  run: sudo sanity check
       
      - name: Sonar analyis 
        run: |
           sudo mkdir /opt/sonarscanner
           wget -P /opt/sonarscanner/ https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-3.3.0.1492.zip
           sudo unzip /opt/sonarscanner/sonar-scanner-cli-3.3.0.1492.zip && sudo rm -rf /opt/sonarscanner/sonar-scanner-cli-3.3.0.1492.zip
           sudo chmod -R 777 /opt/sonarscanner/sonar-scanner-3.3.0.1492
           sudo cp -rfp /opt/sonarscanner/sonar-scanner-3.3.0.1492/bin/sonar-scanner /bin/sonar-scanner
           echo "sonar.login=${{ secrets.SONAR_AUTH_TOKEN}}" >> sonar-project.properties
           echo "sonar.host.url=${{ secrets.SONAR_HOST_URL }}" >> sonar-project.properties
           sudo chmod 777 -R ${GITHUB_WORKSPACE}
           sudo /bin/sonar-scanner       
           
      #- name: Sanity build 
      #  run: | 
      #   sudo sanity build
          
      #- name: sanity deployment
      #  run: |
      #   sudo mkdir -p /home/runner/.config/sanity/ 
      #   sudo cp -p config.json /home/runner/.config/sanity/
      #   sudo sed -i "s|SANITY_AUTH_TOKEN|`echo ${{ secrets.SANITY_AUTH_TOKEN }}`|g" /home/runner/.config/sanity/config.json
      #   echo `cat sanity.json  | jq -r .api.projectId` | sudo sanity deploy
         
       
             
 
     
         
   
  
    
